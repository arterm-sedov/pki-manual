# Вопросы для уточнения к разработчикам

Данный документ содержит список вопросов, которые необходимо уточнить у команды разработки для создания полной и точной документации по установке оператора itcacmistio.

## 1. Целевая платформа и версии

### 1.1. Платформа Kubernetes
- Используется ли generic Kubernetes или есть специфика для облачных провайдеров?
- **Ответ получен**: Generic Kubernetes (без привязки к конкретному облаку)

### 1.2. Версия Istio
- Какую версию Istio следует использовать: последнюю стабильную или конкретно 1.12.2 как в примере?
- Если последнюю, предоставьте обновленные аналоги для `istio-config-1.12.2.yaml`
- Есть ли матрица совместимости между версиями оператора и Istio?

## 2. Детали оператора и чарта

### 2.1. Идентификация
- Точное название оператора и имя Helm чарта
- URL репозитория с исходным кодом
- Путь к чарту (подтвердить что `./chart` - правильный путь)

### 2.2. Custom Resource Definitions (CRD)
- Какие CRD требуются для работы оператора (apiGroups/versions/kinds)?
- Устанавливаются ли CRD автоматически при установке чарта?
- Кто владелец CRD (оператор или внешняя система)?
 - Их кастомный ресурс какого типа? Уточнить точные поля: `apiVersion`, `kind`, plural/shortNames, scope (Namespaced или Cluster), схема (`openAPIV3Schema`), пример манифеста CR (spec/status).
- Мы развёртываем кастомный оператор `itcacmistio`. Какие типы ресурсов он создаёт в кластере?
  - Полный список CRD (apiGroup/version/kind), назначение каждого
  - Какие стандартные ресурсы создаются/модифицируются: `Secrets` (например, `istiod-tls`), `ConfigMaps`, `ServiceAccount`, `ClusterRole/Role`, `RoleBinding/ClusterRoleBinding`, `MutatingWebhookConfiguration`, `ValidatingWebhookConfiguration`, `AdmissionPolicy`, `IstioOperator`/mesh-config патчи
  - Какие ресурсы оператор только читает, а какие — создаёт/обновляет/удаляет
  - Метки/аннотации, которыми оператор помечает управляемые ресурсы

### 2.3. RBAC требования
- Минимальные права (ClusterRole/Role) необходимые оператору
- Требуются ли специальные разрешения для конкретных API?
- Нужен ли cluster-admin для установки или достаточно namespace admin?

## 3. Container Registry и образы

### 3.1. Registry доступ
- URL registry с образами оператора
- Тип учетных данных (robot account, personal token, etc.)
- Как именно чарт использует секрет с учетными данными:
  - Через параметр values?
  - Через imagePullSecrets?
  - Через ServiceAccount?

### 3.2. Управление образами
- Полное имя репозитория с образом
- Политика тегирования версий
- Подтвердить семантику параметра `image.appVersion`
- Соответствует ли `appVersion` тегу Docker образа напрямую?

## 4. Параметры конфигурации

### 4.1. Корневой сертификат (acm.caroot)
- Формат сертификата: обычный PEM или base64-encoded?
- Ограничения на размер сертификата?
- Политика ротации сертификатов
- Поддерживается ли certificate chain?

### 4.2. Параметры кластера
- `cluster.name`: есть ли ограничения на формат имени?
- `cluster.enviroment`: 
  - Допустимые значения только DEV|TEST|PROD?
  - Как окружение влияет на поведение оператора?
  - Есть ли значение по умолчанию?

### 4.3. Серверы конфигурации (acm.configServers)
- Протокол взаимодействия (только HTTPS?)
- Метод аутентификации на серверах
- Требования к валидации сертификатов серверов
- Таймауты и политика повторных попыток
- Что происходит если один из серверов недоступен?

## 5. Интеграция с Istio

### 5.1. Замена Citadel
- Что конкретно заменяется при "Отвязать цитадель из коробки"?
  - Это Istio Citadel CA?
  - Это компонент istiod?
  - Какие именно ресурсы Kubernetes модифицируются?
- Какие объекты патчатся:
  - IstioOperator?
  - ConfigMap с mesh config?
  - MutatingWebhookConfiguration?

### 5.2. Сертификат istiod-tls
- Формат и содержимое файла `istiod-autocert.yaml`
- Какие поля должны быть в секрете `istiod-tls`?
- Как Istio использует этот секрет?

## 6. Операционные требования

### 6.1. Ресурсы
- Рекомендуемые requests/limits для CPU и памяти
- Поддержка Horizontal Pod Autoscaling?
- Требования к persistent storage?

### 6.2. Размещение
- Поддержка topology spread constraints?
- Специфичные node selectors или taints/tolerations?
- Уровень Pod Security Standards (restricted/baseline/privileged)?

### 6.3. Сеть
- Исходящий трафик к `acm.configServers`:
  - Порты и протоколы
  - Требования к proxy
  - Поддержка корпоративных CA
- Входящий трафик:
  - Какие порты expose'ит оператор?
  - Нужен ли Service или Ingress?

### 6.4. Наблюдаемость
- Endpoint для метрик (Prometheus формат?)
- Требуется ли ServiceMonitor для Prometheus Operator?
- Формат логов и уровни логирования
- Поддержка distributed tracing?

## 7. Модель развертывания

### 7.1. Scope работы
- Single-namespace или cluster-wide оператор?
- Поддержка multi-tenancy?
- Можно ли установить несколько экземпляров в разных namespace?

### 7.2. Зависимости
- Требуется ли определенный CNI плагин?
- Зависимость от Ingress controller?
- Нужен ли cert-manager или другие операторы?

## 8. Проверки и валидация

### 8.1. Pre-flight проверки
- Какие проверки выполнить перед установкой:
  - Минимальные версии kubectl/helm?
  - Наличие определенных CRD?
  - Доступность API endpoints?

### 8.2. Post-install валидация
- Критерии успешной установки
- SLI/SLO для оператора
- Health check endpoints
- Readiness/Liveness probes конфигурация
 - Какие признаки «успеха» сразу после установки считаются достаточными?
   - Список ожидаемых ресурсов и их состояния: Deployments/Pods (labels), Secrets (например, `istiod-tls`), ConfigMaps, Webhooks
   - Ожидаемые `status.conditions` у CR (тип, статус, reason/message)
   - Ожидаемые события (`kubectl get events`) и отсутствие критических Warning/Error
   - Ожидаемые сообщения в логах оператора (строки, по которым можно матчить успешную инициализацию)
   - Метрики/показатели, подтверждающие готовность (имена метрик Prometheus, допустимые диапазоны)
   - Проверка интеграции с Istio: факт, что istiod использует внешний CA (как именно это проверить?)
 - Нужен ли автоматизированный скрипт self-check? Если да, какие проверки он должен включать?
 - Для включения конкретных команд проверки в статью укажите точные имена создаваемых контроллеров:
   - Как называется основной контроллер оператора (Deployment/StatefulSet)? Например: `customcertoperator`
   - Подтвердите namespace для него (ожидается `itcacm-citadel-system`)
   - Предоставьте основные метки, чтобы можно было применять селекторы в командах
   - Тогда добавим проверки вида:
     - `kubectl get deployment customcertoperator -n itcacm-citadel-system`
     - `kubectl rollout status deployment/customcertoperator -n itcacm-citadel-system`
     - `kubectl logs deployment/customcertoperator -n itcacm-citadel-system --tail=100`

## 9. Безопасность и соответствие

### 9.1. Управление секретами
- Рекомендации по хранению секретов:
  - Поддержка KMS?
  - Интеграция с SealedSecrets?
  - External Secrets Operator?
- Ротация секретов без downtime?

### 9.2. Compliance
- Требуются ли аудиты перед установкой в PROD?
- Специальные требования для regulated industries?
- Поддержка аудит логов?

## 10. Жизненный цикл и поддержка

### 10.1. Документация
- Кто review'ит документацию?
- Кто утверждает финальную версию?
- Кто отвечает на вопросы по документации?

### 10.2. Обновления
- Частота релизов оператора
- Когда обновлять документацию?
- Процесс уведомления об изменениях

### 10.3. Поддержка
- SLA для ответов на вопросы
- Канал коммуникации (Slack, email, JIRA?)
- Escalation процедуры

## 11. Дополнительная информация

### 11.1. Примеры конфигураций
- Можно ли предоставить примеры для разных сценариев:
  - Минимальная конфигурация
  - Production-ready конфигурация
  - Multi-cluster setup

### 11.2. Миграция
- Есть ли guide по миграции с предыдущих версий?
- Поддержка blue-green deployment?
- Процедура disaster recovery

### 11.3. Известные проблемы
- Список известных issues и workarounds
- Несовместимости с определенными версиями компонентов
- Performance considerations
