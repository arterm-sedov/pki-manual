<!-- 5301ab5d-b199-4481-af78-719b2f1182b5 8e2db146-e898-4020-a96a-bec58e0442d0 -->
# itcacmistio Operator Installation Guide – Plan (Generic Kubernetes)

## Scope

- Produce a practitioner-ready guide (RU) for installing and configuring the `itcacmistio` operator on generic Kubernetes.
- Target latest stable versions at execution time, or explicit versions from the source text when stated.
- Include lifecycle process, missing-info discovery, hands-on steps, validation, rollback, troubleshooting, and security notes.

## Deliverables

- `docs/ru/itcacmistio-operator-installation.md` – main guide following the provided template.
- `docs/ru/appendix/commands.md` – consolidated commands (copy-paste ready).
- `docs/ru/appendix/samples/` – YAML samples adapted from `config/samples/*` with comments.
- `docs/ru/changelog.md` – doc change log and tested version matrix.

## Document structure (aligned with Diátaxis how-to principles)

### Main Guide: `docs/ru/itcacmistio-operator-installation.md`

1. **Как установить оператор itcacmistio в Kubernetes** (focused title)

- Краткое описание результата (что будет достигнуто)
- Предусловия и требования (минимальный список)
- Ссылка на справочные материалы для углубления

2. **Пошаговая установка** (action-focused)

- Шаг 1: Создание namespace `itcacm-citadel-system`
- Шаг 2: Настройка доступа к registry (с примером команды)
- Шаг 3: Установка оператора через Helm (готовая команда с пояснениями параметров)
- Шаг 4: Выпуск сертификата в `istiod-tls`
- Шаг 5: Замена стандартной Istio Citadel на кастомную
- Шаг 6: Проверка успешности установки

3. **Решение типовых проблем** (отдельные how-to)

- Как обновить оператор до новой версии
- Как откатить неудачное обновление
- Как проверить логи при ошибках
- Как обновить сертификаты

### Separate Reference Docs (не смешивать с how-to):

- `docs/ru/reference/parameters.md` - полный справочник параметров
- `docs/ru/reference/architecture.md` - принцип работы и архитектура
- `docs/ru/reference/compatibility.md` - матрица совместимости версий

### Key changes per Diátaxis:

1. Removed explanations from how-to (moved to reference)
2. Task-oriented structure with clear goals
3. Focused on actions, not concepts
4. Practical titles that state the goal
5. Separated lifecycle/process info from installation steps

## Assumptions and versioning policy

- Kubernetes/Istio/Helm versions will be pinned to latest stable during execution (and recorded in the guide). If an explicit version is provided (e.g., `istio-config-1.12.2.yaml`, `image.appVersion=2023.2.1-dev`), we will document both the provided version and the validated latest.
- Generic Kubernetes (no cloud-specific steps). Registry secret examples will use standard `docker-registry` secret type.

## Questions to engineers (including your requests)

1. Target platform?

- Answered: Generic Kubernetes (no cloud-specific features).

2. Istio version to target?

- Latest stable at execution time, or keep 1.12.2 as in sample? If latest, provide updated equivalents to `istio-config-1.12.2.yaml`.

3. Operator/Chart details

- Exact operator name, chart name, and source of truth (repo URL, chart path `./chart`).
- Required CRDs (apiGroups/versions/kinds) and their ownership (installed by chart?).
- Minimal RBAC (ClusterRole/Role) required by operator; any special permissions?

4. Container registry and images

- Image registry URL(s) and credential type (robot account/token) for secret creation.
- Expected secret name and how the chart references it (values key / imagePullSecrets / SA binding).
- Image repository and tag policy; confirm `image.appVersion` semantics.

5. Configuration parameters

- `acm.caroot`: format (PEM string? base64?), size limits, rotation policy.
- `cluster.name` and `cluster.enviroment` allowed values; how environment influences behavior (DEV/TEST/PROD).
- `acm.configServers`: protocol, auth method, certificate validation rules, timeouts/retries.

6. Istio integration

- What exactly is replaced when “Отвязать «цитадель из коробки» и привязать нашу”? Is this Istio Citadel/istiod CA? Which resources are patched (IstioOperator/mesh config/MutatingWebhook)?
- Compatibility matrix between operator and Istio versions.

7. Operational requirements

- Resource requests/limits for operator, topology spread, node selectors/taints, PodSecurity/PSA level.
- Network egress to `acm.configServers`: ports, protocols, proxy requirements.
- Observability: metrics endpoints, ServiceMonitor, logging format/levels.

8. Deployment model

- Single-namespace vs cluster-wide scope; multiple clusters support; multi-tenant constraints.
- Any dependency on CNI/Ingress controller/CertManager present?

9. Pre-/Post-install checks

- Preflight checks to enforce (e.g., kubectl/helm versions, CRD presence, API availability).
- Post-install SLO/health signals and acceptance criteria.

10. Security & compliance

- Secrets management guidelines (KMS/SealedSecrets/ExternalSecrets?).
- Required audits or approvals before PROD.

11. Lifecycle and support

- Who reviews the doc, who approves, who is on-call for questions.
- Release cadence and when to refresh the documentation.

## References to include

- Kubernetes architecture: kubernetes.io/docs/concepts/architecture/
- Pods: kubernetes.io/docs/concepts/workloads/pods/
- Namespaces: kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
- Helm charts: helm.sh/docs/topics/charts/
- Operators overview: cncf.io/blog/.../kubernetes-operators-what-are-they-some-examples/

## Acceptance criteria

- End-to-end installation succeeds on a clean cluster meeting prerequisites.
- All parameters documented with purpose, type, default, and example.
- Validation and rollback sections verified.
- Version matrix and change log populated with tested versions.
- “Questions to engineers” answered or documented with assumptions.

## Risks and mitigations

- Version drift (Istio/K8s/Helm): Mitigate via pinned versions and update triggers.
- Registry access issues: Provide fallback auth methods and clear error remediation.
- Istio integration variability: Provide separate instructions per tested Istio versions.

### To-dos

- [ ] Gather operator/chart details and confirm open questions with engineers
- [ ] Resolve and pin Kubernetes, Istio, Helm, and image versions for testing
- [ ] Draft operator overview and principle of operation sections (RU)
- [ ] Author installation steps: namespace, registry secret, Helm install/update
- [ ] Document Istio integration: istiod-tls secret and citadel replacement
- [ ] Write validation, rollback, troubleshooting, and security sections
- [ ] Prepare commands and YAML samples with comments
- [ ] Write document lifecycle, ownership, and change control